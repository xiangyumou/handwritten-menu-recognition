# æ‰‹å†™è¯†åˆ«åŠ©æ‰‹

ä¸€ä¸ªåŸºäºCloudflare Pagesçš„serverlessæ‰‹å†™æ–‡å­—è¯†åˆ«åº”ç”¨ï¼Œä½¿ç”¨é˜¿é‡Œäº‘DashScope APIè¿›è¡ŒOCRè¯†åˆ«ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **æç®€ç•Œé¢** - æ‹–æ‹½/ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡ï¼Œè‡ªåŠ¨è¯†åˆ«
- ğŸ“Š **å®æ—¶è¿›åº¦** - æ˜¾ç¤ºè¯†åˆ«è¿›åº¦å’ŒçŠ¶æ€
- ğŸ“‹ **ä¸€é”®å¤åˆ¶** - è¯†åˆ«ç»“æœå¯ç›´æ¥å¤åˆ¶ç²˜è´´åˆ°Excel
- ğŸ”„ **å¹¶å‘è¯†åˆ«** - æ”¯æŒå¤šæ¬¡å¹¶å‘è¯†åˆ«æé«˜å‡†ç¡®ç‡ï¼ˆå¯é…ç½®1-10æ¬¡ï¼‰
- âš™ï¸ **é…ç½®çµæ´»** - æ‰€æœ‰å‚æ•°é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†
- ğŸŒ **å…¨çƒåŠ é€Ÿ** - Cloudflare CDNå…¨çƒåˆ†å‘
- ğŸ’° **é›¶æˆæœ¬éƒ¨ç½²** - å…è´¹æ‰˜ç®¡ï¼ˆä»…APIè°ƒç”¨è´¹ç”¨ï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
ocr-web/
â”œâ”€â”€ index.html              # ä¸»é¡µé¢
â”œâ”€â”€ styles.css              # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ script.js               # å‰ç«¯é€»è¾‘
â”œâ”€â”€ config.json             # ä¸šåŠ¡é…ç½® â­
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ constants.js        # å›ºå®šå¸¸é‡
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ ocr.js          # OCR APIç«¯ç‚¹
â”œâ”€â”€ package.json            # ä¾èµ–ç®¡ç†
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: Cloudflare Pages (æ¨è)

#### 1. å‡†å¤‡å·¥ä½œ

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd ocr-web

# å®‰è£…ä¾èµ–
npm install
```

#### 2. é…ç½®APIå¯†é’¥

ç¼–è¾‘ `config.json` ä¸­çš„ä¸šåŠ¡é…ç½®ï¼ˆå¯é€‰ï¼Œä½¿ç”¨é»˜è®¤å€¼ä¹Ÿå¯ä»¥ï¼‰ã€‚

**é‡è¦**: APIå¯†é’¥éœ€è¦åœ¨Cloudflare Pagesä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸è¦æäº¤åˆ°Gitï¼

#### 3. æ¨é€åˆ°GitHub

```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/ocr-web.git
git push -u origin main
```

#### 4. è¿æ¥Cloudflare Pages

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ **Pages** â†’ **Create a project**
3. é€‰æ‹© **Connect to Git**
4. æˆæƒå¹¶é€‰æ‹©ä½ çš„ `ocr-web` ä»“åº“
5. é…ç½®æ„å»ºè®¾ç½®:
   - **æ¡†æ¶é¢„è®¾**: None
   - **æ„å»ºå‘½ä»¤**: (ç•™ç©º)
   - **æ„å»ºè¾“å‡ºç›®å½•**: `/`
   - **Rootç›®å½•**: `/`

#### 5. é…ç½®ç¯å¢ƒå˜é‡

åœ¨Cloudflare Pagesé¡¹ç›®è®¾ç½®ä¸­:

1. è¿›å…¥ **Settings** â†’ **Environment variables**
2. æ·»åŠ ç¯å¢ƒå˜é‡:
   ```
   å˜é‡å: DASHSCOPE_API_KEY
   å€¼: sk-ä½ çš„APIå¯†é’¥
   
   å˜é‡å: ACCESS_TOKEN
   å€¼: ä½ çš„è®¿é—®ä»¤ç‰Œï¼ˆä¾‹å¦‚ï¼šmy_secret_token_123ï¼‰
   ```
3. é€‰æ‹©åº”ç”¨ç¯å¢ƒ: **Production** å’Œ **Preview**
4. ç‚¹å‡» **Save**

#### 6. è§¦å‘éƒ¨ç½²

```bash
# ä»»ä½•pushéƒ½ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
git add .
git commit -m "Update configuration"
git push
```

éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šè·å¾—ä¸€ä¸ª `*.pages.dev` åŸŸåï¼Œä¾‹å¦‚ï¼š
```
https://ocr-web.pages.dev
```

#### 7. è®¿é—®åº”ç”¨

è®¿é—®æ—¶éœ€è¦åœ¨URLä¸­æºå¸¦tokenå‚æ•°ï¼š
```
https://ocr-web.pages.dev?token=ä½ çš„è®¿é—®ä»¤ç‰Œ
```

ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ACCESS_TOKENè®¾ç½®ä¸º`my_secret_token_123`ï¼Œåˆ™è®¿é—®ï¼š
```
https://ocr-web.pages.dev?token=my_secret_token_123
```

**æ³¨æ„**:
- å¦‚æœä¸å¸¦tokenæˆ–tokené”™è¯¯ï¼Œä¼šæ˜¾ç¤º"è®¿é—®å—é™"é¡µé¢
- TokenéªŒè¯ä¿æŠ¤ä½ çš„æœåŠ¡ä¸è¢«æœªæˆæƒè®¿é—®
- è¯·å¦¥å–„ä¿ç®¡ä½ çš„tokenï¼Œä¸è¦å…¬å¼€åˆ†äº«

### æ–¹æ³•2: æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# å®‰è£…ä¾èµ–
npm install

# åˆ›å»ºæœ¬åœ°ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ°Gitï¼‰
cat > .dev.vars << EOF
DASHSCOPE_API_KEY=sk-ä½ çš„APIå¯†é’¥
ACCESS_TOKEN=your_secret_token_here
EOF

# å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—® http://localhost:8788?token=your_secret_token_here
```

**æ³¨æ„**: æœ¬åœ°å¼€å‘æ—¶ä¹Ÿéœ€è¦åœ¨URLä¸­æºå¸¦tokenå‚æ•°æ‰èƒ½è®¿é—®ã€‚

## âš™ï¸ é…ç½®è¯´æ˜

### config.json é…ç½®é¡¹

```json
{
  "ocr": {
    "concurrency": 5,           // å¹¶å‘è¯†åˆ«æ¬¡æ•° (1-10)
    "ocrModel": "qwen-vl-max-latest",      // OCRæ¨¡å‹
    "decisionModel": "qwen-max-latest",    // å†³ç­–æ¨¡å‹
    "enableThinking": false,    // æ˜¯å¦å¯ç”¨æ€è€ƒæ¨¡å¼
    "timeout": 30000            // è¶…æ—¶æ—¶é—´(æ¯«ç§’)
  },
  "prompt": {
    "ocrInstruction": "...",    // OCRè¯†åˆ«æç¤ºè¯
    "decisionInstruction": "..." // å†³ç­–æ•´åˆæç¤ºè¯
  },
  "upload": {
    "maxSizeMB": 10,            // æœ€å¤§æ–‡ä»¶å¤§å°(MB)
    "allowedFormats": [...]     // å…è®¸çš„æ–‡ä»¶æ ¼å¼
  },
  "ui": {
    "title": "æ‰‹å†™è¯†åˆ«åŠ©æ‰‹",
    "description": "...",
    "thumbnailSize": 200        // ç¼©ç•¥å›¾å¤§å°(px)
  }
}
```

### ä¿®æ”¹é…ç½®

1. ç¼–è¾‘ `config.json` æ–‡ä»¶
2. Gitæäº¤å¹¶æ¨é€
3. Cloudflareè‡ªåŠ¨é‡æ–°éƒ¨ç½²

**ç¤ºä¾‹ - æé«˜è¯†åˆ«å‡†ç¡®ç‡:**

```json
{
  "ocr": {
    "concurrency": 7  // ä»5æ”¹ä¸º7æ¬¡å¹¶å‘
  }
}
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **ä¸Šä¼ å›¾ç‰‡**
   - æ‹–æ‹½å›¾ç‰‡åˆ°ä¸Šä¼ åŒºåŸŸ
   - æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
   - æ”¯æŒæ ¼å¼: PNG, JPG, JPEG, WebP
   - å¤§å°é™åˆ¶: 10MB

2. **å¼€å§‹è¯†åˆ«**
   - æŸ¥çœ‹å›¾ç‰‡é¢„è§ˆ
   - ç‚¹å‡» "ğŸš€ å¼€å§‹è¯†åˆ«" æŒ‰é’®
   - ç­‰å¾…è¿›åº¦æ¡å®Œæˆ

3. **å¤åˆ¶ç»“æœ**
   - æŸ¥çœ‹è¯†åˆ«ç»“æœè¡¨æ ¼
   - ç‚¹å‡» "ğŸ“‹ å¤åˆ¶å…¨éƒ¨" æŒ‰é’®
   - ç›´æ¥ç²˜è´´åˆ°Excelæˆ–å…¶ä»–è¡¨æ ¼è½¯ä»¶

### è¯†åˆ«æ•ˆæœä¼˜åŒ–å»ºè®®

- âœ… **å›¾ç‰‡æ¸…æ™°** - ç¡®ä¿æ–‡å­—æ¸…æ™°å¯è¾¨
- âœ… **å…‰çº¿å……è¶³** - é¿å…é˜´å½±å’Œåå…‰
- âœ… **æ­£é¢æ‹æ‘„** - å‡å°‘é€è§†å˜å½¢
- âœ… **é€‚å½“å¤§å°** - 2-5MBä¸ºä½³ï¼Œä¸è¦è¿‡åº¦å‹ç¼©
- âœ… **æé«˜å¹¶å‘** - åœ¨`config.json`ä¸­å¢åŠ å¹¶å‘æ¬¡æ•°

## ğŸ”§ APIæ¥å£æ–‡æ¡£

### POST /api/ocr

**è¯·æ±‚ç¤ºä¾‹:**

```json
{
  "image": "data:image/png;base64,iVBORw0KGgo...",
  "concurrency": 5,
  "enableThinking": false
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "data": {
    "items": [
      ["è‹¹æœ", "5", "çº¢å¯Œå£«"],
      ["ç‰›å¥¶", "2", "1Lè£…"]
    ],
    "metadata": {
      "concurrencyUsed": 5,
      "validAttempts": 5,
      "processingTime": 3.2
    }
  }
}
```

## ğŸ’° æˆæœ¬ä¼°ç®—

| é¡¹ç›® | å…è´¹é¢åº¦ | é¢„è®¡è´¹ç”¨ |
|------|----------|----------|
| Cloudflare Pagesæ‰˜ç®¡ | æ— é™ | $0 |
| Pages Functionsè¯·æ±‚ | 100,000/å¤© | $0 |
| å¸¦å®½ | æ— é™ | $0 |
| DashScope APIè°ƒç”¨ | æŒ‰éœ€è®¡è´¹ | ~Â¥20/æœˆ |
| **æ€»è®¡** | - | **~Â¥20/æœˆ** |

*å‡è®¾æ¯æœˆè¯†åˆ«çº¦500æ¬¡ï¼Œæ¯æ¬¡5æ¬¡å¹¶å‘*

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜: "APIå¯†é’¥æœªé…ç½®"

**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥Cloudflare Pagesç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
- ç¡®è®¤å˜é‡åä¸º `DASHSCOPE_API_KEY`
- é‡æ–°éƒ¨ç½²é¡¹ç›®

### é—®é¢˜: "æœªèƒ½è¯†åˆ«å‡ºæœ‰æ•ˆå†…å®¹"

**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥å›¾ç‰‡æ¸…æ™°åº¦
- ç¡®ä¿æ–‡å­—å¯è¯»
- å¢åŠ å¹¶å‘æ¬¡æ•°ï¼ˆä¿®æ”¹`config.json`ï¼‰
- è°ƒæ•´æç¤ºè¯ä»¥é€‚åº”ç‰¹å®šåœºæ™¯

### é—®é¢˜: éƒ¨ç½²å¤±è´¥

**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥ `package.json` ä¾èµ–æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ `functions/api/ocr.js` è·¯å¾„æ­£ç¡®
- æŸ¥çœ‹Cloudflareéƒ¨ç½²æ—¥å¿—
- å°è¯•é‡æ–°éƒ¨ç½²

### é—®é¢˜: æœ¬åœ°å¼€å‘æ— æ³•è¿è¡Œ

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥.dev.varsæ–‡ä»¶æ˜¯å¦å­˜åœ¨
cat .dev.vars

# é‡å¯å¼€å‘æœåŠ¡å™¨
npm run dev
```

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¸è¦æäº¤æ•æ„Ÿä¿¡æ¯åˆ°Git**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨APIå¯†é’¥å’Œè®¿é—®ä»¤ç‰Œ
   - `.gitignore`å·²é…ç½®å¿½ç•¥`.env`å’Œ`.dev.vars`æ–‡ä»¶
   - æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

2. **è®¿é—®æ§åˆ¶**
   - å·²å®ç°åŸºäºTOKENçš„è®¿é—®æ§åˆ¶
   - è®¿é—®æ—¶å¿…é¡»åœ¨URLä¸­æºå¸¦æ­£ç¡®çš„tokenå‚æ•°
   - å®šæœŸæ›´æ¢ACCESS_TOKENä»¥æé«˜å®‰å…¨æ€§
   - ä¸è¦å°†å¸¦tokençš„URLå…¬å¼€åˆ†äº«

3. **Tokenç®¡ç†æœ€ä½³å®è·µ**
   - ä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆå™¨åˆ›å»ºå¤æ‚tokenï¼ˆå»ºè®®32ä½ä»¥ä¸Šéšæœºå­—ç¬¦ä¸²ï¼‰
   - å®šæœŸè½®æ¢tokenï¼ˆå»ºè®®æ¯æœˆæ›´æ¢ï¼‰
   - ä¸è¦åœ¨å…¬å…±åœºåˆå±•ç¤ºå¸¦tokençš„URL
   - å¦‚æœtokenæ³„éœ²ï¼Œç«‹å³åœ¨Cloudflareç¯å¢ƒå˜é‡ä¸­æ›´æ¢

4. **APIå¯†é’¥ç®¡ç†**
   - å®šæœŸè½®æ¢DashScope APIå¯†é’¥
   - ç›‘æ§APIä½¿ç”¨é‡å’Œå¼‚å¸¸è°ƒç”¨
   - è®¾ç½®æ¶ˆè´¹é™é¢é˜²æ­¢æ»¥ç”¨
   - ä½¿ç”¨é˜¿é‡Œäº‘çš„è®¿é—®æ§åˆ¶åŠŸèƒ½

5. **è¿›é˜¶å®‰å…¨æªæ–½**
   - è€ƒè™‘ä½¿ç”¨Cloudflare Accessæ·»åŠ é¢å¤–èº«ä»½éªŒè¯
   - è®¾ç½®IPç™½åå•ï¼ˆå¦‚æœå›ºå®šIPï¼‰
   - å¯ç”¨Cloudflare WAFè§„åˆ™
   - å®šæœŸæ£€æŸ¥è®¿é—®æ—¥å¿—

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-11)

- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æç®€ç•Œé¢è®¾è®¡
- ğŸ“Š å®æ—¶è¿›åº¦æ˜¾ç¤º
- ğŸ“‹ ä¸€é”®å¤åˆ¶åŠŸèƒ½
- âš™ï¸ é…ç½®æ–‡ä»¶ç®¡ç†
- ğŸ”„ å¹¶å‘è¯†åˆ«æ”¯æŒ

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»:

- GitHub Issues
- Email: your-email@example.com

---

**äº«å—ä¾¿æ·çš„æ‰‹å†™è¯†åˆ«ä½“éªŒï¼** ğŸ‰