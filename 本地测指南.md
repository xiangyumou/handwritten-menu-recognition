# 本地测试指南

## 📋 前置要求

您需要先安装Node.js才能进行本地测试。

### 安装Node.js

1. **下载Node.js**
   - 访问：https://nodejs.org/zh-cn/
   - 下载LTS版本（推荐18.x或20.x）
   - 双击安装，一路Next即可

2. **验证安装**
   打开新的命令行窗口，运行：
   ```bash
   node --version
   npm --version
   ```
   如果显示版本号，说明安装成功。

## 🚀 本地测试步骤

安装Node.js后，按下步骤操作：

### 1. 安装项目依赖

```bash
cd ocr-web
npm install
```

这会安装：
- `openai` - OpenAI/DashScope API客户端
- `wrangler` - Cloudflare开发工具

### 2. 确认API密钥配置

已为您创建好 `.dev.vars` 文件，内容：
```
DASHSCOPE_API_KEY=sk-51bd9d12f5894eea804417fc0c014be7
```

这个文件**不会**Git提交（已在.gitignore中）。

### 3. 启动开发服务器

```bash
npm run dev
```

或直接运行：
```bash
npx wrangler pages dev . --port 8788
```

### 4. 访问应用

浏览器打开：
```
http://localhost:8788
```

### 5. 测试识别功能

1. 拖拽或选择您的测试图片（test1.png 或 test2.png）
2. 点击"🚀 开始识别"
3. 等待进度完成
4. 查看识别结果
5. 点击"📋 复制全部"测试复功能
6. 粘贴到Excel验证格

## 🔧 常见问题

### 问题1: 端口被占用

如果8788端口被占，可以换个端口：
```bash
npx wrangler pages dev . --port 3000
```

### 问题2: API调用失败

检查：
- `.dev.vars` 文件是否存在
- API密钥是否正确
- 网络连接是否正常

### 问题3: 模块找不到

重新安装依赖：
```bash
rm -rf node_modules package-lock.json
npm install
```

Windows系统：
```bash
rmdir /s /q node_modules
del package-lock.json
npm install
```

## 📝 测试要点

### 功能测试清单

- [ ] 图片上传（拖拽）
- [ ] 图片上传（点击选择）
- [ ] 图片预览显示
- [ ] 文件大小验证（超过10MB应提示错误）
- [ ] 文件式验证（只支持PNG/JPG）
- [ ] 识别进度显示
- [ ] 识别结果显示
- [ ] 复制到剪贴板
- [ ] 粘贴到Excel格式正
- [ ] 重新识别功能
- [ ] 错误提示显示

### 性能测试

- 测试不同大小的图片（1MB、5MB、10MB）
- 测试识别时间（应在10-30秒内完成）
- 测试并发配置（修改config.json中的concurrency）

## 🎯 调试技巧

### 查看控制台日志

打开浏览器开发者工具（F12），查看：
- Console标签 - JavaScript日志
- Network标签 - API请求详情

### 查看Wrangler日志

终端会显示：
- API调用日志
- 错误详情
- 性能统计

### 修改配置测试

编辑 `config.json` 测试不同配置：

```json
{
  "ocr": {
    "concurrency": 3  // 改为3次并发测试度
  }
}
```

保存后刷新浏览器即可生效。

## ✅ 测试完成后

如果本地测试一切正常，就可以部署到Cloudflare Pages了！

参考 `README.md` 中的部署步骤。

---

**遇到问题？** 检查：
1. Node.js版本 >= 18
2. `.dev.vars` 文件存在且API密钥正确
3. 网络连接正常
4. 端口未被占用